<UserControl x:Class="WarehouseApp.Views.ProductsWindow"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Заголовок и кнопки -->
        <StackPanel Grid.Row="0" Margin="10">
            <TextBlock Text="Управление товарами и уценками" FontSize="20" FontWeight="Bold"/>
            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                <Button Content="Обновить" Command="{Binding RefreshCommand}" Margin="0,0,10,0"/>
                <Button Content="Загрузить товары" Command="{Binding LoadProductsCommand}" Margin="0,0,10,0"/>
                <TextBlock Text="Скидка:" VerticalAlignment="Center" Margin="20,0,5,0"/>
                <TextBox Text="{Binding DiscountPercentage}" Width="50" Margin="0,0,10,0"/>
                <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <Button Content="Применить скидку" Command="{Binding ApplyDiscountCommand}" 
                        Background="#3498db" Foreground="White" Margin="0,0,10,0"/>
                <Button Content="Снять скидку" Command="{Binding RemoveDiscountCommand}" 
                        Background="#e74c3c" Foreground="White"/>
            </StackPanel>
        </StackPanel>

        <!-- Основное содержимое -->
        <TabControl Grid.Row="1" Margin="10">
            <TabItem Header="Все товары">
                <DataGrid ItemsSource="{Binding Products}" AutoGenerateColumns="False" 
                          SelectedItem="{Binding SelectedProduct}">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="40"/>
                        <DataGridTextColumn Header="Название" Binding="{Binding Name}" Width="120"/>
                        <DataGridTextColumn Header="Базовая цена" Width="90">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="{Binding Path=BasePrice, StringFormat=N2}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Текущая цена" Width="90">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="{Binding Path=CurrentPrice, StringFormat=N2}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Скидка" Width="70">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="{Binding Path=DiscountPercentage, StringFormat=N0}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="На складе" Binding="{Binding QuantityInStock}" Width="80"/>
                        <DataGridTextColumn Header="Вместимость" Binding="{Binding MaxCapacity}" Width="90"/>
                        <DataGridTextColumn Header="Дней до срока" Binding="{Binding DaysUntilExpiry}" Width="100"/>
                        <DataGridTextColumn Header="Стоимость запаса" Width="120">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="{Binding Path=StockValue, StringFormat=N2}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

            <TabItem Header="Товары для уценки">
                <DataGrid ItemsSource="{Binding ExpiringProducts}" AutoGenerateColumns="False">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="40"/>
                        <DataGridTextColumn Header="Товар" Binding="{Binding Name}" Width="120"/>
                        <DataGridTextColumn Header="Дней до срока" Binding="{Binding DaysUntilExpiry}" Width="100"/>
                        <DataGridTextColumn Header="Текущая скидка" Width="100">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="{Binding Path=DiscountPercentage, StringFormat=N0}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Текущая цена" Width="100">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="{Binding Path=CurrentPrice, StringFormat=N2}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="На складе" Binding="{Binding QuantityInStock}" Width="80"/>
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

            <TabItem Header="Уцененные товары">
                <DataGrid ItemsSource="{Binding DiscountProducts}" AutoGenerateColumns="False">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding ProductId}" Width="40"/>
                        <DataGridTextColumn Header="Товар" Binding="{Binding ProductName}" Width="120"/>
                        <DataGridTextColumn Header="Оригинальная цена" Width="120">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="{Binding Path=OriginalPrice, StringFormat=N2}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Цена со скидкой" Width="120">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="{Binding Path=DiscountedPrice, StringFormat=N2}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Скидка" Width="70">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="{Binding Path=DiscountPercentage, StringFormat=N0}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Дней до срока" Binding="{Binding DaysUntilExpiry}" Width="100"/>
                        <DataGridTextColumn Header="Остаток" Binding="{Binding CurrentStock}" Width="70"/>
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>